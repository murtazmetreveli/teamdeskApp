"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1512],{1512:(W,_,g)=>{g.r(_),g.d(_,{BarcodeScanningRoutingModule:()=>X});var v=g(6565),s=g(467),m=g(5083),b=g(4341),d=g(6013);class O extends m.E_{constructor(){super(...arguments),this.ERROR_PICK_FILE_CANCELED="pickFiles canceled."}convertHeicToJpeg(r){var e=this;return(0,s.A)(function*(){throw e.unimplemented("Not implemented on web.")})()}pickFiles(r){var e=this;return(0,s.A)(function*(){const n=yield e.openFilePicker(r);if(!n)throw new Error(e.ERROR_PICK_FILE_CANCELED);const i={files:[]};for(const o of n){const c={blob:o,modifiedAt:o.lastModified,mimeType:e.getMimeTypeFromUrl(o),name:e.getNameFromUrl(o),path:void 0,size:e.getSizeFromUrl(o)};r?.readData&&(c.data=yield e.getDataFromFile(o)),i.files.push(c)}return i})()}pickImages(r){var e=this;return(0,s.A)(function*(){return e.pickFiles(Object.assign({types:["image/*"]},r))})()}pickMedia(r){var e=this;return(0,s.A)(function*(){return e.pickFiles(Object.assign({types:["image/*","video/*"]},r))})()}pickVideos(r){var e=this;return(0,s.A)(function*(){return e.pickFiles(Object.assign({types:["video/*"]},r))})()}openFilePicker(r){var e=this;return(0,s.A)(function*(){var n;const i=(null===(n=r?.types)||void 0===n?void 0:n.join(","))||"",o=!!r?.multiple;return new Promise(c=>{let u=!1;const f=document.createElement("input");f.type="file",f.accept=i,f.multiple=o,f.addEventListener("change",()=>{u=!0;const h=Array.from(f.files||[]);c(h)},{once:!0}),window.addEventListener("focus",(0,s.A)(function*(){yield e.wait(1e3),!u&&c(void 0)}),{once:!0}),f.click()})})()}getDataFromFile(r){return(0,s.A)(function*(){return new Promise((e,n)=>{const i=new FileReader;i.readAsDataURL(r),i.onload=()=>{const u=("string"==typeof i.result?i.result:"").split("base64,")[1]||"";e(u)},i.onerror=o=>{n(o)}})})()}getNameFromUrl(r){return r.name}getMimeTypeFromUrl(r){return r.type}getSizeFromUrl(r){return r.size}wait(r){return(0,s.A)(function*(){return new Promise(e=>setTimeout(e,r))})()}}const k=(0,m.F3)("FilePicker",{web:()=>new O});var t=g(6276),l=g(5933),S=g(177);const A=["square"];function B(a,r){if(1&a){const e=t.RV6();t.j41(0,"ion-fab",6)(1,"ion-fab-button",1),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.toggleTorch())}),t.nrm(2,"ion-icon",7),t.k0s()()}}let M=(()=>{class a{constructor(e,n){this.dialogService=e,this.ngZone=n,this.formats=[],this.lensFacing=d.Nn.Back,this.isTorchAvailable=!1}ngOnInit(){d.vi.isTorchAvailable().then(e=>{this.isTorchAvailable=e.available})}ngAfterViewInit(){setTimeout(()=>{this.startScan()},250)}ngOnDestroy(){this.stopScan()}closeModal(e){var n=this;return(0,s.A)(function*(){n.dialogService.dismiss({barcode:e})})()}toggleTorch(){return(0,s.A)(function*(){yield d.vi.toggleTorch()})()}startScan(){var e=this;return(0,s.A)(function*(){document.querySelector("body")?.classList.add("barcode-scanning-active");const n={formats:e.formats,lensFacing:e.lensFacing},i=e.squareElement?.nativeElement.getBoundingClientRect(),o=i?{left:i.left*window.devicePixelRatio,right:i.right*window.devicePixelRatio,top:i.top*window.devicePixelRatio,bottom:i.bottom*window.devicePixelRatio,width:i.width*window.devicePixelRatio,height:i.height*window.devicePixelRatio}:void 0,c=o?[[o.left,o.top],[o.left+o.width,o.top],[o.left+o.width,o.top+o.height],[o.left,o.top+o.height]]:void 0,u=yield d.vi.addListener("barcodeScanned",function(){var f=(0,s.A)(function*(h){e.ngZone.run(()=>{const p=h.barcode.cornerPoints;c&&p&&(c[0][0]>p[0][0]||c[0][1]>p[0][1]||c[1][0]<p[1][0]||c[1][1]>p[1][1]||c[2][0]<p[2][0]||c[2][1]<p[2][1]||c[3][0]>p[3][0]||c[3][1]<p[3][1])||(u.remove(),e.closeModal(h.barcode))})});return function(h){return f.apply(this,arguments)}}());yield d.vi.startScan(n)})()}stopScan(){return(0,s.A)(function*(){document.querySelector("body")?.classList.remove("barcode-scanning-active"),yield d.vi.stopScan()})()}static{this.\u0275fac=function(n){return new(n||a)(t.rXU(l.W3),t.rXU(t.SKi))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-barcode-scanning"]],viewQuery:function(n,i){if(1&n&&t.GBs(A,5),2&n){let o;t.mGM(o=t.lsd())&&(i.squareElement=o.first)}},inputs:{formats:"formats",lensFacing:"lensFacing"},decls:11,vars:1,consts:[["slot","end"],[3,"click"],["name","close"],[1,"square"],["square",""],["slot","fixed","horizontal","end","vertical","bottom",4,"ngIf"],["slot","fixed","horizontal","end","vertical","bottom"],["name","flashlight"]],template:function(n,i){1&n&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t.EFF(3,"Scanning"),t.k0s(),t.j41(4,"ion-buttons",0)(5,"ion-button",1),t.bIt("click",function(){return i.closeModal()}),t.nrm(6,"ion-icon",2),t.k0s()()()(),t.j41(7,"ion-content"),t.nrm(8,"div",3,4),t.DNE(10,B,3,0,"ion-fab",5),t.k0s()),2&n&&(t.R7$(10),t.Y8G("ngIf",i.isTorchAvailable))},dependencies:[S.bT,l.Jm,l.QW,l.W9,l.Q8,l.YW,l.eU,l.iq,l.BC,l.ai],styles:["ion-content[_ngcontent-%COMP%]{--background: transparent}.square[_ngcontent-%COMP%]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);border-radius:16px;width:200px;height:200px;border:6px solid white;box-shadow:0 0 0 4000px #0000004d}"]})}}return a})();var x=g(7762),C=g(8972),F=g(7157),R=g(369),E=g(7772),w=g(5761),U=g(4503);function j(a,r){if(1&a){const e=t.RV6();t.qex(0),t.j41(1,"ion-button",6),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.scan())}),t.EFF(2,"Scan"),t.k0s(),t.bVm()}if(2&a){const e=t.XpG();t.R7$(1),t.Y8G("disabled",!e.isSupported)}}function G(a,r){if(1&a){const e=t.RV6();t.j41(0,"ion-item",12),t.bIt("click",function(){const o=t.eBV(e).$implicit,c=t.XpG(2);return t.Njj(c.collectionClick(o))}),t.j41(1,"ion-label"),t.EFF(2),t.k0s()()}if(2&a){const e=r.$implicit;t.R7$(2),t.SpI(" ",null==e?null:e.name," ")}}function L(a,r){if(1&a){const e=t.RV6();t.j41(0,"ion-toolbar",7)(1,"ion-title",8),t.EFF(2,"Select Collection Status"),t.k0s()(),t.j41(3,"ion-list",9),t.DNE(4,G,3,1,"ion-item",10),t.k0s(),t.j41(5,"ion-button",11),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.setOpen(!1))}),t.EFF(6,"Close"),t.k0s()}if(2&a){const e=t.XpG();t.R7$(4),t.Y8G("ngForOf",e.collectionDetails)}}function T(a,r){1&a&&t.eu8(0)}const N=[{path:"",component:(()=>{class a{constructor(e,n,i,o,c,u,f,h,p,D,V,$,J,z){var y=this;this.alertController=e,this.router=n,this.dialogService=i,this.ngZone=o,this.route=c,this.location=u,this.storage=f,this.db=h,this.ref=p,this.geo=D,this.loadingController=V,this.analyticservice=$,this.Platform=J,this.navCtrl=z,this.headerData=[],this.collectionDetails=[{name:"Samples Collected"},{name:"Box Empty"},{name:"Samples Not In Bag"},{name:"Other Issue"}],this.barcodeFormat=d.Gi,this.lensFacing=d.Nn,this.dropOff=!1,this.formGroup=new b.gE({formats:new b.MJ([]),lensFacing:new b.MJ(d.Nn.Back),googleBarcodeScannerModuleInstallState:new b.MJ(0),googleBarcodeScannerModuleInstallProgress:new b.MJ(0)}),this.barcodes=[],this.isSupported=!1,this.isPermissionGranted=!1,this.isAlertErrorOpen=!1,this.isLocationPopup=!1,this.scanIsInProgress=!1,this.isModalOpen=!1,this.headerData={title:"SCAN COLLECTION CODE",button_text:"Route Complete",serach:!1},this.beginRoute=localStorage.getItem("begin_route"),this.dataScanSubscription=this.db.dataScan.subscribe(function(){var P=(0,s.A)(function*(I){I&&(console.log("dataScan result:",I),"true"!=y.beginRoute||y.scanIsInProgress?y.router.navigateByUrl("/tabs/tab3"):yield y.scan())});return function(I){return P.apply(this,arguments)}}()),this.dataInsertSubscription=this.db.dataInsertStatus.subscribe(P=>{P&&(console.log("dataInsertStatus",P),"true"==this.beginRoute?this.scan():this.router.navigateByUrl("/tabs/tab3"))})}setOpenError(e){this.isAlertErrorOpen=e}setOpen(e){this.isModalOpen=e}ngOnInit(){return(0,s.A)(function*(){})()}ionViewWillEnter(){var e=this;return(0,s.A)(function*(){e.beginRoute=localStorage.getItem("begin_route"),console.log("--------",e.beginRoute),"ios"===m.Ii.getPlatform()?(yield d.vi.isSupported().then(n=>{e.isSupported=n.supported}),"true"==e.beginRoute?(console.log("Starting from QR Code Scan"),setTimeout((0,s.A)(function*(){e.scanerLoader=yield e.loadingController.create({cssClass:"spinner",mode:"md"}),e.scan()}),500)):e.router.navigateByUrl("/tabs/tab3")):e.checkPermissionsAndScan()})()}checkPermissionsAndScan(){var e=this;return(0,s.A)(function*(){d.vi.isSupported().then(n=>{e.isSupported=n.supported}),d.vi.checkPermissions().then(n=>{e.isPermissionGranted="granted"===n.camera}),d.vi.removeAllListeners().then(()=>{d.vi.addListener("googleBarcodeScannerModuleInstallProgress",n=>{e.ngZone.run(()=>{const{state:i,progress:o}=n;e.formGroup.patchValue({googleBarcodeScannerModuleInstallState:i,googleBarcodeScannerModuleInstallProgress:o})})})}),"true"==e.beginRoute?(e.scanerLoader=yield e.loadingController.create({cssClass:"spinner",mode:"md"}),yield e.scan(),yield e.installGoogleBarcodeScannerModule()):e.router.navigateByUrl("/tabs/tab3")})()}startScan(){var e=this;return(0,s.A)(function*(){const n=e.formGroup.get("formats")?.value||[],i=d.Nn.Back;(yield e.dialogService.create({component:M,cssClass:"barcode-scanning-modal",showBackdrop:!1,componentProps:{formats:n,lensFacing:i}})).onDidDismiss().then(c=>{const u=c.data?.barcode;u&&(e.barcodes=[u])})})()}ngOnDestroy(){this.scanIsInProgress=!1,this.dataScanSubscription&&this.dataScanSubscription.unsubscribe(),this.dataInsertSubscription&&this.dataInsertSubscription.unsubscribe()}ionViewWillLeave(){this.scanIsInProgress=!1,this.dataScanSubscription&&this.dataScanSubscription.unsubscribe(),this.dataInsertSubscription&&this.dataInsertSubscription.unsubscribe()}printCurrentPosition(){var e=this;return(0,s.A)(function*(){try{yield x.L.getCurrentPosition({timeout:1e3}).then(function(){var n=(0,s.A)(function*(i){const o=i.coords.latitude,c=i.coords.longitude;var u=JSON.parse((yield e.storage.get("outbox"))||"[]");u instanceof Array||(u=[u]),u[0].Location=`${o}, ${c}`,yield e.storage.set("outbox",JSON.stringify(u)),e.isModalOpen=!0,e.ref.detectChanges(),console.log("isModalOpen",e.isModalOpen)});return function(i){return n.apply(this,arguments)}}()).catch(function(){var n=(0,s.A)(function*(i){e.scanerLoader.dismiss(),setTimeout((0,s.A)(function*(){let o="";var u;o="ios"===m.Ii.getPlatform()?"( setting > privacy & Security > Location Services)":"( setting > Location )",yield(yield e.alertController.create({header:"Enable Location Services",message:`Please enable location services in your device settings to use this feature. ${o}`,cssClass:"alertControl",mode:"ios",buttons:[{text:"Cancel",role:"cancel",handler:()=>{}},{text:"Go to Settings",handler:(u=(0,s.A)(function*(){"ios"===m.Ii.getPlatform()?yield C.a.openUrl({url:"app-settings:"}):"android"===m.Ii.getPlatform()?yield C.a.openUrl({url:"com.android.settings"}):console.log("Web!")}),function(){return u.apply(this,arguments)})}]})).present()}),1e3)});return function(i){return n.apply(this,arguments)}}())}catch{e.scanerLoader.dismiss(),"ios"!=m.Ii.getPlatform()&&(yield(yield e.alertController.create({header:"Enable Location Services",message:"Please enable location services in your device settings to use this feature.",cssClass:"alertControl",mode:"ios",buttons:[{text:"Cancel",role:"cancel",handler:()=>{}},{text:"Go to Settings",handler:(o=(0,s.A)(function*(){"ios"===m.Ii.getPlatform()||("android"===m.Ii.getPlatform()?yield C.a.openUrl({url:"com.android.settings"}):console.log("Web!"))}),function(){return o.apply(this,arguments)})}]})).present())}var o})()}readBarcodeFromImage(){var e=this;return(0,s.A)(function*(){const{files:n}=yield k.pickImages({multiple:!1}),i=n[0]?.path;if(!i)return;const o=e.formGroup.get("formats")?.value||[],{barcodes:c}=yield d.vi.readBarcodesFromImage({path:i,formats:o});e.barcodes=c})()}scan(){var e=this;return(0,s.A)(function*(){e.scanIsInProgress=!0,yield e.scanerLoader.present();try{e.scanerLoader?.dismiss();const{barcodes:n}=yield d.vi.scan();if(console.log("barcodes------",n),e.ref.detectChanges(),e.barcodes=n,e.barcodes){let i={practiceId:e.barcodes[0].displayValue};yield e.storage.set("outbox",JSON.stringify(i)),e.analyticservice.log({name:"scan_data_store_outbox",params:i}),yield e.printCurrentPosition(),e.scanIsInProgress=!1}}catch(n){console.error("Error scanning barcodes:",n),e.scanerLoader?.dismiss(),e.scanIsInProgress=!1}finally{e.scanIsInProgress=!1}})()}openSettings(){return(0,s.A)(function*(){yield d.vi.openSettings()})()}installGoogleBarcodeScannerModule(){return(0,s.A)(function*(){yield d.vi.installGoogleBarcodeScannerModule()})()}requestPermissions(){return(0,s.A)(function*(){yield d.vi.requestPermissions()})()}objCheck(e){return!!Object.keys(e)}collectionClick(e){var n=this;return(0,s.A)(function*(){var i=JSON.parse((yield n.storage.get("outbox"))||"[]");i instanceof Array||(i=[i]),i[0].Status=e.name,yield n.storage.set("outbox",JSON.stringify(i)),e&&(n.dialogService.dismiss(),yield n.setOpen(!1),n.scanIsInProgress=!1,n.dataScanSubscription&&n.dataScanSubscription.unsubscribe()),n.Platform.is("ios")?n.navCtrl.navigateRoot(["upload-images"]):yield n.router.navigateByUrl("upload-images")})()}static{this.\u0275fac=function(n){return new(n||a)(t.rXU(l.hG),t.rXU(v.Ix),t.rXU(l.W3),t.rXU(t.SKi),t.rXU(v.nX),t.rXU(S.aZ),t.rXU(R.w),t.rXU(E.a),t.rXU(t.gRc),t.rXU(x.L),t.rXU(l.Xi),t.rXU(w.L),t.rXU(F.OD),t.rXU(F.q9))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-barcode-scanning"]],decls:9,vars:5,consts:[[1,"ion-padding","barcode-scanner",3,"fullscreen"],[3,"headerObj"],["size","12"],[4,"ngIf"],["mode","md",3,"isOpen"],[4,"ngFor","ngForOf"],["expand","block",3,"disabled","click"],[1,"ion-text-center"],[1,"title"],["lines","inset"],["class","ion-text-center",3,"click",4,"ngFor","ngForOf"],[1,"close",3,"click"],[1,"ion-text-center",3,"click"]],template:function(n,i){1&n&&(t.j41(0,"ion-content",0),t.nrm(1,"app-sub-header",1),t.j41(2,"ion-grid")(3,"ion-row")(4,"ion-col",2),t.DNE(5,j,3,1,"ng-container",3),t.j41(6,"ion-modal",4),t.DNE(7,L,7,1,"ng-template"),t.k0s(),t.DNE(8,T,1,0,"ng-container",5),t.k0s()()()()),2&n&&(t.Y8G("fullscreen",!0),t.R7$(1),t.Y8G("headerObj",i.headerData),t.R7$(4),t.Y8G("ngIf",i.objCheck(i.barcodes)),t.R7$(1),t.Y8G("isOpen",i.isModalOpen),t.R7$(2),t.Y8G("ngForOf",i.barcodes))},dependencies:[S.Sq,S.bT,l.Jm,l.hU,l.W9,l.lO,l.uz,l.he,l.nf,l.ln,l.BC,l.ai,l.Sb,U.R],styles:["ion-modal[_ngcontent-%COMP%]{--height: 330px;--width: 100%;--border-radius: 16px;--box-shadow: transparent;margin:60pt 15% 0}ion-title[_ngcontent-%COMP%]{color:var(--ion-text-green);font-size:16px}ion-toolbar[_ngcontent-%COMP%]{width:auto;margin:9px 9px 0;border-top-left-radius:10px;border-top-right-radius:10px;border-bottom:1px solid var(--ion-text-color)}ion-modal[_ngcontent-%COMP%]::part(backdrop){background:transparent;opacity:1}  ion-modal>.ion-page{background:transparent}ion-modal[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: transparent;--color: var(--ion-search-placeholder-color)}ion-list[_ngcontent-%COMP%]{height:100%;background-color:var(--ion-bg-rgba-gray-color-opacity);margin:-10pt 7pt;border-radius:10px}ion-list[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:#000;font-size:18px}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: transparent;--padding-start: 0;--border-color: var(--border-tab)}  .close{border-color:var(--ion-text-green);--border-radius: 8px;z-index:99999;margin:10px 28px}  .alertControl{--background: var(--ion-text-green)}  .alert-button-group>button{color:#fff!important}"]})}}return a})()}];let X=(()=>{class a{static{this.\u0275fac=function(n){return new(n||a)}}static{this.\u0275mod=t.$C({type:a})}static{this.\u0275inj=t.G2t({imports:[v.iI.forChild(N),v.iI]})}}return a})()}}]);